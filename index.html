cat > public/index.html <<'EOF'
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>qura chat</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700&display=swap" rel="stylesheet">


  <style>
    :root{
      --bg:#0b0f1a;
      --panel:#0f1424;
      --panel2:#121a2d;
      --line:rgba(255,255,255,.08);
      --text:#e9ecf5;
      --muted:rgba(233,236,245,.7);
      --accent:#6c5ce7;
      --accent2:#00cec9;
      --danger:#ff7675;
      --shadow:0 20px 60px rgba(0,0,0,.55);
      --radius:18px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:"Plus Jakarta Sans",system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      color:var(--text);
      background:
        radial-gradient(1000px 600px at 15% 10%, rgba(108,92,231,.18), transparent 60%),
        radial-gradient(1000px 700px at 85% 30%, rgba(0,206,201,.12), transparent 55%),
        radial-gradient(900px 900px at 50% 120%, rgba(255,118,117,.10), transparent 55%),
        var(--bg);
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:20px;
    }


    .app{
      width:min(1100px, 100%);
      height:min(720px, 92vh);
      display:grid;
      grid-template-columns: 360px 1fr;
      gap:14px;
    }


    .card{
      background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      border:1px solid var(--line);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      overflow:hidden;
      backdrop-filter: blur(10px);
    }


    /* LEFT */
    .left{
      display:flex;
      flex-direction:column;
      min-height:0;
    }
    .brand{
      padding:18px 18px 12px;
      border-bottom:1px solid var(--line);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }
    .logo{
      display:flex;
      align-items:center;
      gap:10px;
      font-weight:800;
      letter-spacing:.3px;
    }
    .dot{
      width:12px;height:12px;border-radius:999px;
      background:conic-gradient(from 180deg, var(--accent), var(--accent2), var(--danger), var(--accent));
      box-shadow:0 0 0 4px rgba(108,92,231,.12);
    }
    .balance{
      font-size:12px;
      color:var(--muted);
      display:flex;
      align-items:center;
      gap:8px;
      background:rgba(0,0,0,.25);
      border:1px solid var(--line);
      padding:8px 10px;
      border-radius:999px;
    }
    .balance strong{color:var(--text)}
    .panel{
      padding:14px 14px 10px;
      display:flex;
      flex-direction:column;
      gap:10px;
    }


    .field{
      display:flex;
      flex-direction:column;
      gap:6px;
    }
    .field label{
      font-size:12px;
      color:var(--muted);
    }
    .input{
      width:100%;
      background:rgba(0,0,0,.25);
      border:1px solid var(--line);
      color:var(--text);
      padding:12px 12px;
      border-radius:14px;
      outline:none;
      transition:.15s;
    }
    .input:focus{border-color:rgba(108,92,231,.55); box-shadow:0 0 0 4px rgba(108,92,231,.12);}
    .row{
      display:flex;
      gap:10px;
    }
    .btn{
      border:0;
      cursor:pointer;
      font-weight:800;
      padding:12px 12px;
      border-radius:14px;
      color:white;
      background:linear-gradient(135deg, rgba(108,92,231,1), rgba(0,206,201,.9));
      box-shadow: 0 10px 26px rgba(108,92,231,.22);
      transition:.15s transform, .15s filter;
    }
    .btn:active{transform:translateY(1px)}
    .btn.secondary{
      background:rgba(255,255,255,.06);
      border:1px solid var(--line);
      color:var(--text);
      box-shadow:none;
    }
    .hint{
      font-size:12px;
      color:var(--muted);
      line-height:1.35;
      padding:0 14px 14px;
    }
    .hint code{
      background:rgba(0,0,0,.25);
      border:1px solid var(--line);
      padding:2px 6px;
      border-radius:8px;
      color:var(--text);
    }


    /* RIGHT */
    .right{
      display:flex;
      flex-direction:column;
      min-height:0;
    }
    .topbar{
      padding:16px 16px 12px;
      border-bottom:1px solid var(--line);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
    }
    .title{
      display:flex;
      flex-direction:column;
      gap:2px;
    }
    .title h1{
      margin:0;
      font-size:16px;
      letter-spacing:.2px;
    }
    .title p{
      margin:0;
      font-size:12px;
      color:var(--muted);
    }
    .status{
      display:flex;
      align-items:center;
      gap:8px;
      font-size:12px;
      color:var(--muted);
      background:rgba(0,0,0,.25);
      border:1px solid var(--line);
      padding:8px 10px;
      border-radius:999px;
      white-space:nowrap;
    }
    .pill{
      width:8px;height:8px;border-radius:999px;background:var(--accent2);
      box-shadow:0 0 0 4px rgba(0,206,201,.12);
    }


    .messages{
      flex:1;
      min-height:0;
      padding:16px;
      overflow:auto;
      display:flex;
      flex-direction:column;
      gap:10px;
      scroll-behavior:smooth;
    }


    .bubble{
      max-width:min(520px, 86%);
      padding:12px 12px;
      border-radius:16px;
      border:1px solid var(--line);
      background:rgba(0,0,0,.25);
      box-shadow:0 10px 26px rgba(0,0,0,.2);
    }
    .bubble.me{
      margin-left:auto;
      background:linear-gradient(180deg, rgba(108,92,231,.25), rgba(108,92,231,.12));
      border-color:rgba(108,92,231,.25);
    }
    .bubble.other{
      margin-right:auto;
      background:linear-gradient(180deg, rgba(255,255,255,.07), rgba(255,255,255,.03));
    }
    .meta{
      font-size:11px;
      color:var(--muted);
      margin-top:6px;
      display:flex;
      gap:10px;
    }
    .meta b{color:rgba(233,236,245,.85); font-weight:700}


    .composer{
      padding:14px;
      border-top:1px solid var(--line);
      display:flex;
      gap:10px;
      align-items:flex-end;
    }
    .textarea{
      flex:1;
      resize:none;
      min-height:44px;
      max-height:120px;
      padding:12px 12px;
      border-radius:14px;
      border:1px solid var(--line);
      background:rgba(0,0,0,.25);
      color:var(--text);
      outline:none;
      font-family:inherit;
      line-height:1.35;
    }
    .textarea:focus{border-color:rgba(0,206,201,.45); box-shadow:0 0 0 4px rgba(0,206,201,.10);}
    .send{
      width:120px;
    }


    @media (max-width: 900px){
      .app{grid-template-columns:1fr; height:auto}
      .left{order:2}
      .right{order:1; min-height:60vh}
      .send{width:96px}
    }
  </style>
</head>


<body>
  <div class="app">
    <section class="card left">
      <div class="brand">
        <div class="logo"><span class="dot"></span> qura</div>
        <div class="balance">coins: <strong id="coinsVal">0</strong></div>
      </div>


      <div class="panel">
        <div class="field">
          <label>me (email)</label>
          <input id="meEmail" class="input" placeholder="maks2ode@gmail.com"/>
        </div>


        <div class="field">
          <label>partner (email)</label>
          <input id="partnerEmail" class="input" placeholder="quradating@gmail.com"/>
        </div>


        <div class="row">
          <button id="applyBtn" class="btn secondary" style="flex:1;">Apply</button>
          <button id="clearBtn" class="btn secondary" style="flex:1;">Clear</button>
        </div>
      </div>


      <div class="hint">
        Якщо чат “порожній” — перевір що відкрито з параметрами:
        <div style="margin-top:8px;">
          <code>?me=...&partner=...</code>
        </div>
      </div>
    </section>


    <section class="card right">
      <div class="topbar">
        <div class="title">
          <h1 id="chatTitle">Chat</h1>
          <p id="chatSub">waiting…</p>
        </div>
        <div class="status"><span class="pill"></span> firestore connected</div>
      </div>


      <div id="messages" class="messages"></div>


      <div class="composer">
        <textarea id="msgInput" class="textarea" placeholder="Type a message…"></textarea>
        <button id="sendBtn" class="btn send">Send</button>
      </div>
    </section>
  </div>


  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import {
      getFirestore, collection, addDoc, query, where, limit, onSnapshot, serverTimestamp
    } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";


    // --- Firebase config (YOUR PROJECT) ---
    // ВАЖЛИВО: якщо тут уже був твій config — лишай як є.
    // Якщо ти колись міняв його — встав свій правильний firebaseConfig нижче.
    const firebaseConfig = {
      apiKey: "REPLACE_ME",
      authDomain: "REPLACE_ME",
      projectId: "quradating777",
      storageBucket: "REPLACE_ME",
      messagingSenderId: "REPLACE_ME",
      appId: "REPLACE_ME"
    };


    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);


    const msgBox = document.getElementById("messages");
    const msgInput = document.getElementById("msgInput");
    const sendBtn = document.getElementById("sendBtn");
    const meEmailEl = document.getElementById("meEmail");
    const partnerEmailEl = document.getElementById("partnerEmail");
    const applyBtn = document.getElementById("applyBtn");
    const clearBtn = document.getElementById("clearBtn");
    const chatTitle = document.getElementById("chatTitle");
    const chatSub = document.getElementById("chatSub");
    const coinsVal = document.getElementById("coinsVal");


    const params = new URLSearchParams(location.search);
    const myEmail = params.get("me") || "";
    const partnerEmail = params.get("partner") || "";
    let userCoins = parseInt(params.get('coins')) || 0;


  // If URL params are missing, show quick setup (no console needed)
  if (!myEmail || !partnerEmail) {
    const wrap = document.createElement('div');
    wrap.style.cssText = 'position:fixed;inset:0;background:rgba(0,0,0,.65);display:flex;align-items:center;justify-content:center;z-index:9999;padding:16px;';
    wrap.innerHTML = `
      <div style="width:min(520px,100%);background:#151922;border:1px solid rgba(255,255,255,.12);border-radius:14px;padding:16px;color:#fff;font-family:system-ui">
        <div style="font-size:18px;font-weight:700;margin-bottom:8px;">Налаштування чату</div>
        <div style="opacity:.85;margin-bottom:12px;font-size:13px;line-height:1.35;">Вкажи 2 email. Я збережу їх у браузері і перезавантажу сторінку з правильними параметрами.</div>
        <label style="display:block;margin:8px 0 4px;font-size:12px;opacity:.85;">Твій email (me)</label>
        <input id="meInput" style="width:100%;padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,.16);background:#0f1220;color:#fff;" placeholder="наприклад: maks2ode@gmail.com">
        <label style="display:block;margin:10px 0 4px;font-size:12px;opacity:.85;">Email співрозмовника (partner)</label>
        <input id="partnerInput" style="width:100%;padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,.16);background:#0f1220;color:#fff;" placeholder="наприклад: quradating@gmail.com">
        <div style="display:flex;gap:10px;margin-top:14px;">
          <button id="saveSetup" style="flex:1;padding:10px 12px;border-radius:10px;border:0;background:#6c5ce7;color:#fff;font-weight:700;cursor:pointer;">Зберегти</button>
        </div>
        <div id="setupErr" style="margin-top:10px;color:#ff7675;font-size:12px;"></div>
      </div>`;
    document.body.appendChild(wrap);


    const me0 = localStorage.getItem('qura_me') || '';
    const partner0 = localStorage.getItem('qura_partner') || '';
    wrap.querySelector('#meInput').value = me0;
    wrap.querySelector('#partnerInput').value = partner0;


    wrap.querySelector('#saveSetup').onclick = () => {
      const me = wrap.querySelector('#meInput').value.trim();
      const partner = wrap.querySelector('#partnerInput').value.trim();
      const err = wrap.querySelector('#setupErr');
      if (!me || !partner || !me.includes('@') || !partner.includes('@')) {
        err.textContent = 'Введи 2 коректні email.';
        return;
      }
      localStorage.setItem('qura_me', me);
      localStorage.setItem('qura_partner', partner);
      const url = new URL(location.href);
      url.searchParams.set('me', me);
      url.searchParams.set('partner', partner);
      history.replaceState(null, '', url.toString());
      location.reload();
    };
    throw new Error('Setup required: missing URL params.');
  }


  // Show JS errors on screen (so you don't need DevTools)
  const errBox = document.createElement('div');
  errBox.style.cssText = 'position:fixed;left:12px;right:12px;bottom:12px;max-height:35vh;overflow:auto;z-index:9998;background:rgba(0,0,0,.75);border:1px solid rgba(255,255,255,.12);border-radius:12px;padding:10px;color:#ffcccc;font:12px/1.35 system-ui;display:none;';
  document.body.appendChild(errBox);
  function showErr(msg){ errBox.style.display='block'; errBox.textContent = msg; }
  window.addEventListener('error', (e)=> showErr(String(e.error?.stack || e.message || e)));
  window.addEventListener('unhandledrejection', (e)=> showErr(String(e.reason?.stack || e.reason || e)));


    coinsVal.textContent = String(userCoins);
    meEmailEl.value = myEmail;
    partnerEmailEl.value = partnerEmail;


    chatTitle.textContent = "Chat";
    chatSub.textContent = `${myEmail} ↔ ${partnerEmail}`;


    function esc(s){
      return (s ?? "").toString()
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }


    function fmtTime(ts){
      try{
        const d = ts?.toDate ? ts.toDate() : new Date();
        return d.toLocaleString();
      }catch(e){
        return "";
      }
    }


    function renderMessage(data){
      const isMe = (data.sender === myEmail);
      const div = document.createElement("div");
      div.className = "bubble " + (isMe ? "me" : "other");
      div.innerHTML = `
        <div>${esc(data.text || "")}</div>
        <div class="meta">
          <b>${esc(data.sender || "")}</b>
          <span>${esc(fmtTime(data.createdAt))}</span>
        </div>
      `;
      msgBox.appendChild(div);
    }


    function resetUI(){
      msgBox.innerHTML = "";
    }


    // ---- Listen messages (no orderBy -> no composite index needed) ----
    function initChat(){
      resetUI();


      const q = query(
        collection(db, "messages"),
        where("participants", "array-contains", myEmail),
        limit(200)
      );


      onSnapshot(q, (snapshot) => {
        resetUI();
        const rows = [];
            snapshot.forEach((doc) => {
          const data = doc.data();
          if (data.participants && data.participants.includes(partnerEmail)) rows.push(data);
        });
            rows.sort((a,b)=> {
                const ta = a.createdAt?.toMillis ? a.createdAt.toMillis() : 0;
                const tb = b.createdAt?.toMillis ? b.createdAt.toMillis() : 0;
                return ta - tb;
            });
            rows.forEach(renderMessage);
            setTimeout(() => msgBox.scrollTop = msgBox.scrollHeight, 100);
      }, (err) => {
        showErr("Firestore onSnapshot error:\n" + (err?.message || err));
      });
    }


    // ---- Send ----
    async function sendMessage(){
      const text = msgInput.value.trim();
      if(!text) return;


      await addDoc(collection(db, "messages"), {
        sender: myEmail,
        participants: [myEmail, partnerEmail],
        text,
        createdAt: serverTimestamp()
      });


      msgInput.value = "";
      msgInput.focus();
    }


    sendBtn.onclick = () => sendMessage();


    msgInput.addEventListener("keydown", (e) => {
      if(e.key === "Enter" && !e.shiftKey){
        e.preventDefault();
        sendMessage();
      }
    });


    applyBtn.onclick = () => {
      const me = meEmailEl.value.trim();
      const partner = partnerEmailEl.value.trim();
      const url = new URL(location.href);
      url.searchParams.set("me", me);
      url.searchParams.set("partner", partner);
      history.replaceState(null, "", url.toString());
      location.reload();
    };


    clearBtn.onclick = () => {
      const url = new URL(location.href);
      url.searchParams.delete("me");
      url.searchParams.delete("partner");
      history.replaceState(null, "", url.toString());
      location.reload();
    };


    initChat();
  </script>
</body>
</html>
EOF
